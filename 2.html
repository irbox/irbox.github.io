<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner App - Single File</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* --- START OF EMBEDDED styles.css --- */
        html,
        body,
        p,
        ol,
        ul,
        li,
        dl,
        dt,
        dd,
        blockquote,
        figure,
        fieldset,
        legend,
        textarea,
        pre,
        iframe,
        hr,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0;
            padding: 0;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-size: 100%;
            font-weight: normal;
        }

        ul {
            list-style: none;
        }

        button,
        input,
        select,
        textarea {
            margin: 0
        }

        html {
            box-sizing: border-box
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit
        }

        img,
        embed,
        object,
        audio {
            height: auto;
            max-width: 100%
        }

        iframe {
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        td,
        th {
            padding: 0;
            text-align: left
        }

        body {
          font-family: Roboto, Helvetica,Arial,sans-serif;
          -webkit-font-smoothing: antialiased;
        }

        .app__layout {
          position: absolute;
          width: 100%;
          height: 100%;
          overflow: hidden;
          background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background for whole layout */
        }

        .app__header {
          width: 100%;
          height: 56px;
          color: #fff;
          background-color: #3F51B5; /* Added a background for visibility */
          display: flex;
          -webkit-box-align: center;
          -ms-flex-align: center;
          align-items: center;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 10;
        }

        .app__header-icon {
          width: 35px;
          height: 35px;
          display: -webkit-box;
          display: -ms-flexbox;
          display: flex;
          -webkit-box-align: center;
          -ms-flex-align: center;
          align-items: center;
          -webkit-box-pack: center;
          -ms-flex-pack: center;
          justify-content: center;
          cursor: pointer;
          position: absolute;
          right: 20px;
          top: 50%; /* Vertically center */
          transform: translateY(-50%); /* Vertically center */
        }

        .app__header-icon:active {
          opacity: 0.8;
        }

        .app__header-title {
          margin-left: 15px; /* Adjusted margin */
          font-size: 19px;
          user-select: none;
        }

        .app__layout-content {
          height: 100%; /* Changed from inherit */
          padding-top: 56px; /* Account for fixed header */
          overflow-y: auto;
          background-color: #f0f0f0; /* Light background for content area */
          position: relative;
        }

        .custom-menu-icon {
          font-size: 28px;
          line-height: 47px;
        }

        .custom-title,
        .custom-menu-icon {
          color: #fff;
        }

        .custom-btn {
          position: fixed;
          right: 26px;
          bottom: 26px;
          background: #448aff;
          border-radius: 50%;
          border: none;
          width: 56px;
          height: 56px;
          outline: none;
          box-shadow: 0 2px 2px 0 rgba(0,0,0,.14), 0 3px 1px -2px rgba(0,0,0,.2), 0 1px 5px 0 rgba(0,0,0,.12);
          z-index: 999; /* Lowered slightly to be below dialogs/snackbar */
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .custom-btn:active {
          box-shadow: none;
        }

        .custom-msg {
          text-align: center;
          width: 90%;
          /* height: 50%; -- Removed fixed height to allow flex centering */
          overflow: auto;
          margin: auto;
          position: absolute;
          top: 0; /* Adjusted for flex centering */
          left: 0; /* Adjusted for flex centering */
          bottom: 0; /* Adjusted for flex centering */
          right: 0; /* Adjusted for flex centering */
          font-size: 16px;
          display: flex; /* For centering content */
          flex-direction: column; /* For centering content */
          justify-content: center; /* For centering content */
          align-items: center; /* For centering content */
        }

        .custom-fab-icon {
          color: #fff;
          font-size: 30px;
          /* margin-top: 2px; -- Removed, handled by flex in .custom-btn */
          user-select: none;
        }

        video#camera { /* Specific to the camera element */
          transform: translateX(-50%) translateY(-50%);
          top: 50%;
          left: 50%;
          min-width: 100%;
          min-height: 100%;
          width: auto;
          height: auto;
          position: absolute;
          object-fit: cover; /* Ensure it covers the area */
          background-color: #000; /* Black background while loading/if error */
        }

        #list {
            padding: 0 10px; /* Add some padding to the list container */
        }
        #list li {
          list-style-type: none;
          text-decoration: underline;
          color: #00F;
          padding: 8px 5px; /* padding inside list items */
          border-bottom: 1px solid #eee;
          word-break: break-all;
          cursor: pointer;
          transition: background-color 0.2s;
        }
        #list li:hover {
            background-color: #e0e0e0;
        }


        .custom-copy-btn {
          opacity: 0; /* Will be made visible by JS */
          position: fixed; /* Example positioning */
          bottom: 100px;
          left: 50%;
          transform: translateX(-50%);
          padding: 10px 20px;
          background-color: #4CAF50;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          z-index: 100;
        }
        .custom-copy-btn.show { /* Utility class to show it */
            opacity: 1;
        }


        .hide {
          display: none !important; /* Added !important for stronger override */
        }

        @-webkit-keyframes scanner {
          0% { bottom: 90%; }
          50% { bottom: 10%; }
          100% { bottom: 90%; }
        }
        @-moz-keyframes scanner {
          0% { bottom: 90%; }
          50% { bottom: 10%; }
          100% { bottom: 90%; }
        }
        @-o-keyframes scanner {
          0% { bottom: 90%; }
          50% { bottom: 10%; }
          100% { bottom: 90%; }
        }
        @keyframes scanner {
          0% { bottom: 90%; }
          50% { bottom: 10%; }
          100% { bottom: 90%; }
        }

        .custom-scanner {
          width: 80%; /* Adjusted for better visuals */
          max-width: 270px;
          height: 2px;
          background: #4CAF50;
          position: absolute;
          /* transition: all 200ms linear; -- Removed, not needed with keyframes */
          animation: scanner 3s infinite linear;
          box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.4);
          display: none; /* Initially hidden, shown by JS */
          left: 0; /* Centering */
          right: 0; /* Centering */
          margin: auto; /* Centering */
          /* top/bottom controlled by animation */
        }

        #camera { /* This selector already exists for video, be careful */
          opacity: 0; /* Used to hide video initially by JS logic */
        }

        .no-support {
          font-size: 16px; /* Adjusted for consistency */
          text-align: center;
          color: #c00; /* Error color */
          margin-top: 10px;
        }

        .app__snackbar {
          position: fixed;
          bottom: 15px;
          left: 50%; /* Centered snackbar */
          transform: translateX(-50%); /* Centered snackbar */
          pointer-events: none;
          z-index: 9999;
          width: auto; /* Allow content to define width */
          max-width: 90%; /* Max width on small screens */
        }

        .app__snackbar-msg {
          min-width: 250px; /* Minimum width */
          width: auto; /* Adjust to content */
          padding: 10px 15px; /* Adjusted padding */
          min-height: 50px;
          background-color: #404040;
          color: #fff;
          border-radius: 3px;
          box-shadow: 0 0 2px rgba(0,0,0,.12), 0 2px 4px rgba(0,0,0,.24);
          display: flex;
          align-items: center;
          justify-content: center; /* Center text in snackbar */
          font-size: 14px;
          font-weight: 500;
          word-break: break-all;
          transition: opacity 0.3s cubic-bezier(0, 0, 0.30, 1), transform 0.3s cubic-bezier(0, 0, 0.30, 1); /* Added transform */
          text-transform: initial;
          /* margin-bottom: 10px; -- Not needed if only one snackbar message div */
          opacity: 0; /* Start hidden */
          transform: translateY(20px); /* Start off-screen */
        }

        .app__snackbar-msg:not(.app__snackbar--hide) { /* When shown */
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto; /* Allow events when visible */
        }
        /* .app__snackbar--hide is now handled by default opacity:0 and transform */


        .app__infodialog,
        .app__dialog {
          z-index: 1002; /* Above overlays */
          background-color: #fff;
          width: 290px;
          /* height: 180px; -- Let content define height */
          min-height: 180px;
          border-radius: 8px;
          display: flex; /* Will be 'none' when hidden */
          flex-direction: column; /* Stack content vertically */
          position: fixed; /* Changed from absolute for viewport centering */
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%);
          box-shadow: 0 9px 46px 8px rgba(0,0,0,.14), 0 11px 15px -7px rgba(0,0,0,.12), 0 24px 38px 3px rgba(0,0,0,.2);
        }

        .app__infodialog {
          max-width: 480px;
          width: 90%; /* Responsive width */
          /* height: 240px; -- Let content define height */
          min-height: 240px;
        }

        .app__dialog-content,
        .app__infodialog-content {
          width: 100%;
          padding: 20px; /* Increased padding */
          flex-grow: 1; /* Allow content to take available space */
          overflow-y: auto; /* Scroll if content too long */
        }

        .app__infodialog-subcontent {
          margin-top: 18px;
        }

        .app__infodialog-subcontent a {
          color: #1b1eb5;
        }

        .app__infodialog-subcontent p:not(:first-child) {
          margin-top: 10px;
        }

        .app__dialog-content h1,
        .app__infodialog h1 { /* Target h1 inside app__infodialog as well */
          margin-top: 0; /* Removed top margin */
          margin-bottom: 15px;
          font-weight: 600;
          font-size: 19px;
        }

        .app__dialog input {
          width: 100%; /* Full width input */
          height: 35px; /* Increased height */
          border: none;
          border-bottom: 1px solid rgba(0,0,0,.24);
          outline: none;
          font-size: 15px;
          color: #1b1eb5;
          font-weight: 500;
          padding: 5px 0; /* Add some padding */
        }

        .app__dialog-actions,
        .app__infodialog-actions {
          display: flex; /* Use flex for button alignment */
          justify-content: flex-end; /* Align buttons to the right */
          padding: 10px 20px; /* Padding around actions area */
          border-top: 1px solid #eee; /* Separator line */
          /* position: absolute; bottom: 13px; right: 20px; -- Removed for flex layout */
        }

        .app__infodialog-open,
        .app__infodialog-close,
        .app__dialog-open,
        .app__dialog-close {
          border: 0;
          height: 35px;
          padding: 0 15px; /* Padding for buttons */
          /* width: 70px; -- Let padding define width */
          font-size: 14px; /* Adjusted font size */
          background: transparent;
          font-weight: 500;
          outline: none;
          cursor: pointer;
          margin-left: 8px; /* Space between buttons */
          /* margin-right: -15px; -- Removed */
          text-transform: uppercase; /* Common for dialog buttons */
          color: #448aff; /* Action color */
        }
        .app__dialog-close, .app__infodialog-close {
            color: #757575; /* Neutral color for close/cancel */
        }

        .app__dialog-open {
          /* display: none; -- Controlled by JS or CSS override if needed */
        }

        .app__infodialog-open:active,
        .app__infodialog-close:active,
        .app__dialog-open:active,
        .app__dialog-close:active {
          opacity: 0.8; /* Adjusted from 0.9 */
          background-color: rgba(0,0,0,0.05); /* Slight background on active */
        }

        /* .app__infodialog--hide, .app__dialog--hide are handled by global .hide class */


        .app__overlay {
          position: fixed; /* Use fixed to cover viewport during scan */
          top: 56px; /* Below header */
          bottom: 0;
          right: 0;
          left: 0;
          /* transition: all 200ms ease-in; -- Not clearly used */
          /* width: 310px; height: 310px; margin: auto; -- These make it a small box, not an overlay */
          display: flex;
          justify-content: center;
          align-items: center;
          /* border: 0; -- Not needed for div */
        }

        /* The following app__overlay-left/right seem to be for a specific viewfinder style */
        /* For a general camera view, these might not be what you want covering the video */
        /* Let's adjust them to create a "window" */
        .app__overlay .viewfinder-container {
            position: relative;
            width: 280px; /* Size of the clear scanning area */
            height: 280px;
            border: 2px solid rgba(255,255,255,0.7); /* White border for the viewfinder */
            box-shadow: 0 0 0 9999px rgba(0,0,0,0.5); /* This creates the overlay effect */
        }

        /*
        .app__overlay-left,
        .app__overlay-right {
          width: 52px;
          height: 340px;
          background: #7f7f7f;
        }
        .app__overlay-left {
          margin-left: -57px;
          margin-top: -10px;
        }
        .app__overlay-right {
          margin-right: -57px;
          margin-top: -340px;
          float: right;
        }
        */

        .app__help-text,
        .app__select-photos-text { /* Renamed for clarity */
          color: #fff;
          position: absolute;
          bottom: 20px; /* Adjusted position */
          font-size: 16px; /* Adjusted font size */
          left: 0; /* Centering */
          right: 0; /* Centering */
          text-align: center;
          user-select: none;
          padding: 5px;
          background-color: rgba(0,0,0,0.3); /* Slight background for readability */
        }

        .app__help-text {
          /* display: none; -- Controlled by JS */
          bottom: 60px; /* Position above other controls if shown */
        }

        .app__dialog-overlay,
        .app__infodialog-overlay {
          position: fixed;
          left: 0;
          right: 0;
          bottom: 0;
          top: 0;
          background: rgba(0, 0, 0, 0.55);
          z-index: 1001; /* Below dialog, above content */
        }

        .camera__icon, /* These seem unused in provided HTML structure */
        .focus__icon {
          position: relative;
          left: 10px;
          display: none;
        }

        .app__select-photos {
          width: 56px; /* Standard FAB size */
          height: 56px; /* Standard FAB size */
          cursor: pointer;
          position: fixed;
          bottom: 26px;
          /* right: 20px; -- FABs usually stack or are offset */
          right: 92px; /* Offset from camera toggle FAB */
          border-radius: 50%;
          background-color: #3F51B5;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 2px 2px 0 rgba(0,0,0,.14), 0 3px 1px -2px rgba(0,0,0,.2), 0 1px 5px 0 rgba(0,0,0,.12);
          z-index: 999;
        }

        .app__select-photos:active {
          opacity: 0.8;
          box-shadow: none;
        }

        input[type='file'] {
          display: none;
        }

        #frame { /* For displaying selected image */
          width: 100%; /* Fill content area */
          height: 100%; /* Fill content area */
          object-fit: contain; /* Show whole image, letterboxed if needed */
          position: absolute;
          top: 0; left: 0;
        }

        .app__version {
          position: absolute;
          bottom: 5px; /* Closer to bottom */
          left: 50%; /* Centered */
          transform: translateX(-50%); /* Centered */
          font-size: 10px; /* Smaller */
          color: #737373;
          /* margin-top: 15px; -- Not needed with absolute positioning */
          display: inline-block;
          z-index: 1; /* Ensure visible above content background */
        }

        .app__scanner-img { /* This class seems unused */
          z-index: 1;
          position: relative;
          display: none;
        }

        @media screen and (max-width: 480px) {
          .app__infodialog {
            width: 95%; /* Slightly more width on small screens */
          }

          .app__infodialog-content {
            padding: 15px; /* Adjust padding */
          }

          .app__select-photos {
            right: 82px; /* Adjust offset for smaller screens if needed */
          }
           .app__snackbar {
            width: 90%;
            left: 5%;
            transform: translateX(0);
            bottom: 10px;
          }
          .app__header-title {
            margin-left: 10px;
            font-size: 18px;
          }
          .app__header-icon {
            right: 10px;
          }
        }
        /* --- END OF EMBEDDED styles.css --- */

        /* Additional style to prevent content overlap with fixed header in JS logic */
        .app__layout-content.with-fixed-header {
            padding-top: 56px;
            height: calc(100vh - 56px);
        }
        /* Ensure video doesn't overflow layout content and is properly scaled */
        .app__layout-content video#camera {
            object-fit: cover;
        }
        
        /* Override for the .app__dialog-open button to make it visible for demo */
        .app__dialog-open {
            display: inline-block !important; /* Make SAVE button in dialog visible */
            color: #448aff; /* Typical confirm button color */
        }
        .app__dialog-open:active {
             opacity: 0.8; /* Copied from other dialog buttons */
        }

    </style>
</head>
<body>
  <div class="app__layout">
    <!-- Overlays for Dialogs -->
    <div class="app__dialog-overlay hide" id="genericDialogOverlay"></div>
    <div class="app__infodialog-overlay hide" id="infoDialogOverlay"></div>

    <!-- Header -->
    <header class="app__header">
      <h1 class="app__header-title custom-title">QR Scanner</h1>
      <div class="app__header-icon" id="infoButton">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
      </div>
    </header>

    <!-- Main Content -->
    <main class="app__layout-content with-fixed-header">
      <video id="camera" autoplay playsinline muted class="hide"></video>

      <div class="app__overlay hide" id="scannerView">
          <div class="viewfinder-container"> <!-- For the visual scanner box -->
              <div class="custom-scanner" id="scannerLine"></div>
          </div>
      </div>
      
      <img src="#" id="frame" class="hide" alt="Selected QR Code Image">

      <div class="custom-msg" id="statusMessageContainer">
        <p id="statusMessage">Tap camera to scan, or folder to select image.</p>
        <p class="no-support hide" id="noSupportMessage">Your browser does not support camera access or other necessary features.</p>
      </div>

      <ul id="list">
        <!-- Scanned items will be added here by JS -->
      </ul>

      <button class="custom-copy-btn hide" id="copyButton">Copy Last Result</button>
      <p class="app__help-text hide" id="scanHelpText">Center QR code in the frame</p>
    </main>

    <!-- FAB to start/stop camera scan -->
    <button class="custom-btn" id="cameraToggleButton">
      <svg class="custom-fab-icon" id="fabIconCamera" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M9.4 10.55c-.83.2-1.5.76-1.95 1.45l-2.89 4.33c-.31.46-.1.99.44 1.17.2.06.4.06.59 0l2.51-1.06c.28-.12.59-.04.79.19l1.26 1.26c.39.39 1.02.39 1.41 0l6.18-6.18c.39-.39.39-1.02 0-1.41l-1.26-1.26c-.23-.23-.57-.3-.86-.19l-2.2 1.09c-.32.16-.71.08-1.03-.16L9.95 9.4c-.22-.23-.56-.3-.85-.19l-.01.01zM21 6h-3.17L16 4H8L6.17 6H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-9 13c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
      <svg class="custom-fab-icon hide" id="fabIconStop" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 0 24 24" width="30px" fill="#FFFFFF"><path d="M0 0h24v24H0z" fill="none"/><path d="M6 6h12v12H6z"/></svg>
    </button>

    <!-- Button to select photos -->
    <div class="app__select-photos" id="selectFileButton">
        <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 0 24 24" width="28px" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
    </div>
    <input type="file" id="fileInput" accept="image/*">

    <!-- Snackbar -->
    <div class="app__snackbar">
      <div class="app__snackbar-msg" id="snackbar">
        <!-- Message will be set by JS -->
      </div>
    </div>

    <!-- Info Dialog -->
    <div class="app__infodialog hide" id="infoDialog">
      <div class="app__infodialog-content">
        <h1>App Information</h1>
        <div class="app__infodialog-subcontent">
          <p>This QR Code Scanner application is a demonstration based on provided CSS styles.</p>
          <p><strong>Simulated Features:</strong></p>
          <ul>
            <li>"Scan" QR codes using your device camera.</li>
            <li>"Scan" QR codes from uploaded image files.</li>
          </ul>
          <p>Actual QR code decoding logic is not implemented.</p>
          <p style="margin-top:15px;"><strong>Feature Images:</strong></p>
          <div style="display: flex; justify-content: space-around; align-items: center; margin-top: 10px; flex-wrap: wrap; gap: 10px;">
             <!--
                IMPORTANT: For a true single file experience, replace these img src with Base64 data URIs.
                Example: src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA
                AAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO
                9TXL0Y4OHwAAAABJRU5ErkJggg==" (This is a tiny red dot example)
             -->
             <img src="img/feature-simple.png" alt="Feature Simple" style="width:30%; max-width: 80px; border:1px solid #ccc; border-radius: 4px;">
             <img src="img/feature-offline.png" alt="Feature Offline" style="width:30%; max-width: 80px; border:1px solid #ccc; border-radius: 4px;">
             <img src="img/feature-add-to-home.png" alt="Feature Add to Home" style="width:30%; max-width: 80px; border:1px solid #ccc; border-radius: 4px;">
          </div>
        </div>
        <div class="app__infodialog-actions">
          <button class="app__infodialog-close" id="infoDialogCloseButton">CLOSE</button>
        </div>
      </div>
    </div>

    <!-- Generic Dialog (Example) -->
    <div class="app__dialog hide" id="genericDialog">
        <div class="app__dialog-content">
            <h1>Sample Input</h1>
            <input type="text" placeholder="Enter some data" id="dialogInput">
        </div>
        <div class="app__dialog-actions">
            <button class="app__dialog-close" id="genericDialogCloseButton">CANCEL</button>
            <button class="app__dialog-open" id="genericDialogConfirmButton">SAVE</button> 
        </div>
    </div>
    
    <div class="app__version">v1.0 (Single File Demo)</div>
  </div>

<script>
// --- START OF EMBEDDED script.js ---
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const cameraView = document.getElementById('camera');
    const frameView = document.getElementById('frame');
    const scannerView = document.getElementById('scannerView');
    const scannerLine = document.getElementById('scannerLine');
    const statusMessageContainer = document.getElementById('statusMessageContainer');
    const statusMessage = document.getElementById('statusMessage');
    const noSupportMessage = document.getElementById('noSupportMessage');
    const resultList = document.getElementById('list');
    const copyButton = document.getElementById('copyButton');
    const scanHelpText = document.getElementById('scanHelpText');

    // Buttons
    const cameraToggleButton = document.getElementById('cameraToggleButton');
    const fabIconCamera = document.getElementById('fabIconCamera');
    const fabIconStop = document.getElementById('fabIconStop');
    const selectFileButton = document.getElementById('selectFileButton');
    const fileInput = document.getElementById('fileInput');
    const infoButton = document.getElementById('infoButton');

    // Dialogs & Overlays
    const infoDialog = document.getElementById('infoDialog');
    const infoDialogOverlay = document.getElementById('infoDialogOverlay');
    const infoDialogCloseButton = document.getElementById('infoDialogCloseButton');

    const genericDialog = document.getElementById('genericDialog');
    const genericDialogOverlay = document.getElementById('genericDialogOverlay');
    const genericDialogCloseButton = document.getElementById('genericDialogCloseButton');
    const genericDialogConfirmButton = document.getElementById('genericDialogConfirmButton');
    const dialogInput = document.getElementById('dialogInput');

    // Snackbar
    const snackbar = document.getElementById('snackbar');

    let stream;
    let isCameraActive = false;
    let lastScannedData = null;
    let snackbarTimeout;

    // --- Helper Functions ---
    const showElement = (el, displayType = 'flex') => { // Default to flex for dialogs
        el.classList.remove('hide');
        if (displayType !== 'flex' && (el.id === 'infoDialog' || el.id === 'genericDialog')) {
             // Dialogs use flex, others might need specific display
        } else {
            el.style.display = displayType;
        }
    };
    const hideElement = (el) => {
        el.classList.add('hide');
        el.style.display = ''; // Reset display style
    };
    
    function showSnackbar(message) {
        clearTimeout(snackbarTimeout); // Clear existing timer
        snackbar.textContent = message;
        snackbar.classList.remove('app__snackbar--hide'); // This class isn't used now, opacity handles it
        
        // Force reflow to restart animation if called consecutively
        snackbar.style.opacity = '0';
        snackbar.style.transform = 'translateY(20px)';
        void snackbar.offsetHeight; // Trigger reflow

        snackbar.style.opacity = '1';
        snackbar.style.transform = 'translateY(0)';

        snackbarTimeout = setTimeout(() => {
            snackbar.style.opacity = '0';
            snackbar.style.transform = 'translateY(20px)';
        }, 3000);
    }

    function updateAppView(mode) { // 'idle', 'camera', 'image'
        hideElement(cameraView);
        hideElement(frameView);
        hideElement(scannerView);
        hideElement(scannerLine);
        hideElement(scanHelpText);
        statusMessageContainer.classList.remove('custom-msg-centered'); // custom-msg is already flex centered

        resultList.style.display = 'block'; // Show list by default

        if (mode === 'idle') {
            statusMessage.textContent = 'Tap camera to scan, or folder to select image.';
            showElement(statusMessageContainer, 'flex');
            fabIconCamera.classList.remove('hide');
            fabIconStop.classList.add('hide');
            copyButton.classList.remove('show');
            if (resultList.children.length === 0) { // Hide list if empty
                resultList.style.display = 'none';
            }
        } else if (mode === 'camera') {
            showElement(cameraView, 'block'); // Video is block
            cameraView.style.opacity = '1'; // Make visible
            showElement(scannerView, 'flex'); // Overlay uses flex for centering viewfinder
            showElement(scannerLine, 'block'); // Scanner line is block
            showElement(scanHelpText, 'block');
            statusMessage.textContent = 'Point camera at QR code...';
            showElement(statusMessageContainer, 'flex');
            fabIconCamera.classList.add('hide');
            fabIconStop.classList.remove('hide');
            resultList.style.display = 'none'; // Hide list during camera view
            copyButton.classList.remove('show');
        } else if (mode === 'image') {
            showElement(frameView, 'block'); // Image is block
            statusMessage.textContent = 'Processing image...';
            showElement(statusMessageContainer, 'flex');
            fabIconCamera.classList.remove('hide');
            fabIconStop.classList.add('hide');
            resultList.style.display = 'none'; // Hide list during image view
            copyButton.classList.remove('show');
        }
    }
    
    async function startCamera() {
        if (isCameraActive) return;
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            noSupportMessage.classList.remove('hide');
            statusMessage.textContent = 'Camera not supported.';
            updateAppView('idle');
            return;
        }
        hideElement(noSupportMessage); // Hide if previously shown
        try {
            stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            cameraView.srcObject = stream;
            // Wait for video to load metadata to prevent black screen flicker
            cameraView.onloadedmetadata = () => {
                isCameraActive = true;
                updateAppView('camera');
                 // Simulate scanning after a delay
                setTimeout(() => {
                    if(isCameraActive) simulateScan('Camera');
                }, 3500); // scanner animation is 3s
            };
        } catch (err) {
            console.error("Error accessing camera:", err);
            statusMessage.textContent = 'Could not access camera. Check permissions.';
            noSupportMessage.classList.remove('hide');
            isCameraActive = false;
            updateAppView('idle');
        }
    }

    function stopCamera() {
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        isCameraActive = false;
        cameraView.srcObject = null;
        cameraView.style.opacity = '0'; // Hide video with opacity
        updateAppView('idle');
        hideElement(scannerLine);
    }

    cameraToggleButton.addEventListener('click', () => {
        if (isCameraActive) {
            stopCamera();
        } else {
            startCamera();
        }
    });

    selectFileButton.addEventListener('click', () => {
        if (isCameraActive) stopCamera();
        fileInput.click();
    });

    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                frameView.src = e.target.result;
                updateAppView('image');
                setTimeout(() => simulateScan('Image: ' + file.name.substring(0,20)), 1500);
            }
            reader.readAsDataURL(file);
        }
        fileInput.value = '';
    });

    function simulateScan(source) {
        if (!isCameraActive && !frameView.src.startsWith('data:image') && !frameView.src.startsWith('blob:')) {
             if (frameView.src === window.location.href + "#") { // src="#" resolves to current URL + #
                // This happens if an image scan was initiated but no image was actually loaded (e.g. user cancelled file dialog)
                updateAppView('idle');
                return;
            }
        }
        
        const mockData = `Simulated QR Data from ${source} - ${new Date().toLocaleTimeString()}`;
        addResultToList(mockData);
        showSnackbar('QR Code "found"! (Simulated)');
        
        if (isCameraActive) {
             // For continuous scan simulation (optional)
             // setTimeout(() => { if(isCameraActive) simulateScan('Camera (continuous)'); }, 3500);
             // For this demo, stop after one "scan" to show result list
             stopCamera();
        } else {
            // After image scan, go back to idle to show list
            updateAppView('idle');
        }
    }

    function addResultToList(data) {
        lastScannedData = data;
        const listItem = document.createElement('li');
        listItem.textContent = data;
        listItem.title = "Click to copy this item";
        listItem.addEventListener('click', () => {
            copyToClipboard(data);
        });

        if (resultList.firstChild) {
            resultList.insertBefore(listItem, resultList.firstChild);
        } else {
            resultList.appendChild(listItem);
        }
        copyButton.classList.add('show'); // Show copy button
        showElement(copyButton, 'block'); // Ensure it's display: block
    }
    
    copyButton.addEventListener('click', () => {
        if (lastScannedData) {
            copyToClipboard(lastScannedData);
        }
    });
    
    async function copyToClipboard(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            try {
                await navigator.clipboard.writeText(text);
                showSnackbar('Copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                showSnackbar('Failed to copy.');
            }
        } else {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = 'fixed'; // Prevent scrolling to bottom
            textArea.style.top = '-9999px';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showSnackbar('Copied (fallback method).');
            } catch (err) {
                console.error('Fallback copy failed: ', err);
                showSnackbar('Copying not supported.');
            }
            document.body.removeChild(textArea);
        }
    }

    function toggleDialog(dialogEl, overlayEl, show) {
        if (show) {
            showElement(dialogEl, 'flex'); // Dialogs use display:flex
            showElement(overlayEl, 'block'); // Overlays are block
        } else {
            hideElement(dialogEl);
            hideElement(overlayEl);
        }
    }

    infoButton.addEventListener('click', () => toggleDialog(infoDialog, infoDialogOverlay, true));
    infoDialogCloseButton.addEventListener('click', () => toggleDialog(infoDialog, infoDialogOverlay, false));
    infoDialogOverlay.addEventListener('click', () => toggleDialog(infoDialog, infoDialogOverlay, false));

    document.querySelector('.app__header-title').addEventListener('click', (e) => {
        e.preventDefault(); // Prevent any default action if it were a link
        dialogInput.value = '';
        toggleDialog(genericDialog, genericDialogOverlay, true);
    });
    genericDialogCloseButton.addEventListener('click', () => toggleDialog(genericDialog, genericDialogOverlay, false));
    genericDialogOverlay.addEventListener('click', () => toggleDialog(genericDialog, genericDialogOverlay, false));
    genericDialogConfirmButton.addEventListener('click', () => {
        const inputValue = dialogInput.value.trim();
        if (inputValue) {
            showSnackbar(`Generic Dialog Saved: ${inputValue.substring(0,20)}...`);
            addResultToList(`From Dialog: ${inputValue}`);
        } else {
            showSnackbar('Input is empty.');
        }
        toggleDialog(genericDialog, genericDialogOverlay, false);
    });
    
    updateAppView('idle');
});
// --- END OF EMBEDDED script.js ---
</script>
</body>
</html>
