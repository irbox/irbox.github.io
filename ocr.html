<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hindi OCR Extractor</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tesseract.js (load from CDN) -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <!-- PDF.js (load from CDN - ensure paths are correct if you host them) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;
    </script>

    <style>
        /* Reuse the same styles from your main app, with potential minor tweaks for this page */
        :root {
            --primary-color: #4A90E2;
            --primary-color-rgb: 74, 144, 226;
            --secondary-color: #2868C7;
            --background-color: #0D1117;
            --surface-color: #161B22;
            --text-color: #C9D1D9;
            --text-muted-color: #8B949E;
            --success-color: #238636;
            --success-hover-color: #2EA043;
            --success-color-rgb: 35, 134, 54;
            --error-color: #DA3633;
            --error-color-rgb: 218, 54, 51;
            --border-color: #30363D;
            --input-background: #22272E;
            --input-focus-border: var(--primary-color);
            --glow-color: rgba(var(--primary-color-rgb), 0.35);
            --success-glow-color: rgba(var(--success-color-rgb), 0.35);

            --font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --font-display: var(--font-sans);
            --font-body: var(--font-sans);

            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 16px;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.25), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -4px rgba(0, 0, 0, 0.25);

            --gradient-primary: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            --gradient-success: linear-gradient(135deg, var(--success-hover-color) 0%, var(--success-color) 100%);
            --gradient-border-animated: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--primary-color));
        }

        @keyframes backgroundPan {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes borderShine {
            0% { background-position: -100% 0; }
            100% { background-position: 100% 0; }
        }


        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-body);
            line-height: 1.65;
            background-color: var(--background-color);
            background-image: linear-gradient(120deg, var(--background-color) 0%, #1a2330 50%, var(--background-color) 100%);
            background-size: 200% 200%;
            animation: backgroundPan 25s ease infinite;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 30px 15px; 
            overflow-x: hidden;
        }

        .app-header {
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            text-align: left;
        }

        .app-header a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        .app-header a:hover {
            color: var(--secondary-color);
        }
        .app-header a .fas {
            margin-right: 6px;
        }


        .container {
            width: 100%;
            max-width: 800px;
            background-color: var(--surface-color);
            background-image: linear-gradient(180deg, color-mix(in srgb, var(--surface-color) 105%, black) 0%, var(--surface-color) 100%);
            padding: 30px; 
            border-radius: var(--border-radius-lg);
            box-shadow: 0 0 0 1px var(--border-color), var(--shadow-lg);
            margin-bottom: 30px;
        }
        
        .main-title { /* For this page, used as a section title */
            font-family: var(--font-display);
            font-size: 1.8rem; 
            font-weight: 700;
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            background: linear-gradient(45deg, var(--primary-color), color-mix(in srgb, var(--primary-color) 60%, #fff));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
            padding-bottom: 5px;
        }
        .sub-title {
            text-align: center;
            color: var(--text-muted-color);
            margin-bottom: 30px; 
            font-size: 0.95rem;
            font-weight: 300;
        }

        h2 { /* Main section title for OCR */
            font-family: var(--font-display);
            font-weight: 600; 
            color: var(--text-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            font-size: 1.6em;
            border-bottom: 2px solid transparent;
            border-image-slice: 1;
            border-image-source: linear-gradient(to right, var(--primary-color), color-mix(in srgb, var(--primary-color) 30%, var(--border-color)));
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h2 .fas { 
            color: var(--primary-color);
            font-size: 1.2em; 
        }

        .ocr-section { margin-bottom: 30px; }
        
        button.action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px 20px;
            background-image: var(--gradient-primary);
            background-size: 100% auto;
            color: white;
            border: none; 
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: 1.05em; 
            font-family: var(--font-body);
            font-weight: 600;
            text-shadow: 0 1px 1px rgba(0,0,0,0.2);
            transition: all 0.25s ease-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.05) inset;
        }
        button.action-button:hover:not(:disabled) {
            filter: brightness(1.1);
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 6px 12px rgba(var(--primary-color-rgb), 0.2), 0 0 15px var(--glow-color), 0 0 0 1px rgba(255,255,255,0.1) inset;
        }
        button.action-button:disabled {
            background-image: none;
            background-color: color-mix(in srgb, var(--surface-color) 70%, var(--text-muted-color));
            color: var(--text-muted-color);
            cursor: not-allowed;
            transform: translateY(0) scale(1);
            box-shadow: none; text-shadow: none;
        }
        button.action-button .fa-spin { display: none; }
        button.action-button:disabled .fa-spin { display: inline-block; margin-left: 8px; }

        .file-input-wrapper {
            position: relative; width: 100%; padding: 35px;
            border: 2px dashed var(--border-color); border-radius: var(--border-radius-md);
            text-align: center; cursor: pointer; margin-bottom: 25px;
            background-color: var(--input-background); 
            transition: border-color 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }
        .file-input-wrapper::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border-radius: inherit; padding: 2px;
            background: var(--gradient-border-animated); background-size: 200% auto;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: destination-out; mask-composite: exclude;
            opacity: 0; transition: opacity 0.3s ease; animation: borderShine 3s linear infinite paused;
        }
        .file-input-wrapper:hover { border-color: transparent; }
        .file-input-wrapper:hover::before { opacity: 1; animation-play-state: running; }
        .file-input-wrapper input[type="file"] {
            position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer;
        }
        .file-input-text { 
            color: var(--text-muted-color); font-size: 1.1em; display: flex;
            align-items: center; justify-content: center; gap: 12px; position: relative; z-index: 1;
        }
        .file-input-text .fas { color: var(--primary-color); font-size: 1.4em; transition: transform 0.3s ease; }
        .file-input-wrapper:hover .file-input-text .fas { transform: scale(1.1) translateY(-2px); }
        .selected-file-display {
            display: block; font-size: 0.95em; color: var(--primary-color);
            margin-top: 10px; font-weight: 500; word-break: break-all; position: relative; z-index: 1;
        }

        .status {
            margin-top: 20px; font-weight: 500; color: var(--text-muted-color);
            font-size: 0.9em; min-height: 1.5em; text-align: center;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }
        .status.success { color: var(--success-color); text-shadow: 0 0 8px var(--success-glow-color); }
        .status.error { color: var(--error-color); text-shadow: 0 0 8px rgba(var(--error-color-rgb), 0.4); }
        .status.processing { color: var(--primary-color); text-shadow: 0 0 8px var(--glow-color); }
        .status .fas.fa-spinner { margin-right: 6px; }
        
        .ocr-output-area {
            margin-top: 25px;
            width: 100%;
        }
        .ocr-output-area textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            background-color: var(--input-background);
            color: var(--text-color);
            font-family: var(--font-sans); /* Or a monospace font if preferred for text */
            font-size: 0.95em;
            resize: vertical;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .ocr-output-area textarea:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1), 0 0 0 3px var(--glow-color);
        }

        .download-buttons {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .download-buttons button {
            width: auto; /* Override full width from .action-button if class is reused */
            padding: 10px 20px;
            font-size: 0.95em;
            background-image: var(--gradient-success); /* Success gradient for download */
        }
        .download-buttons button:hover:not(:disabled){
            filter: brightness(1.1);
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 6px 12px rgba(var(--success-color-rgb), 0.2), 0 0 15px var(--success-glow-color);
        }


        .info-message { /* Similar to warning-message */
            background-color: rgba(var(--primary-color-rgb), 0.05);
            color: var(--primary-color);
            padding: 15px 20px;
            border: 1px solid rgba(var(--primary-color-rgb), 0.3);
            border-left: 5px solid var(--primary-color);
            border-radius: var(--border-radius-md);
            margin: 30px auto 0 auto;
            font-size: 0.9em;
            max-width: 100%;
            display: flex; align-items: flex-start; gap: 12px;
        }
        .info-message .fas { font-size: 1.2em; margin-top: 3px; }
        .info-message strong { font-weight: 600; }

        footer {
            text-align: center; margin-top: 40px; padding-bottom: 20px;
            color: var(--text-muted-color); font-size: 0.85em; font-weight: 300;
        }

        /* Preview canvas (hidden) */
        #pdfPreviewCanvas { display: none; }

        @media (max-width: 768px) {
            body { padding: 20px 10px; }
            .container { padding: 25px; }
            h2 { font-size: 1.4em; }
            .file-input-wrapper { padding: 25px; }
            .download-buttons { flex-direction: column; }
            .download-buttons button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="app-header">
        <a href="/"><i class="fas fa-arrow-left"></i> Back to Converters</a>
    </div>

    <div class="container">
        <h1 class="main-title">Hindi OCR</h1>
        <p class="sub-title">Extract Text from PDFs & Images (हिंदी)</p>

        <div class="ocr-section">
            <h2><i class="fas fa-language"></i> Text Extractor</h2>
            
            <div class="file-input-wrapper" id="ocrFileWrapper">
                <span class="file-input-text"><i class="fas fa-file-import"></i> Click or Drag PDF/Image Here</span>
                <input type="file" id="ocrFile" accept=".pdf,.png,.jpg,.jpeg,.bmp,.tiff">
                <span class="selected-file-display" id="ocrFileName"></span>
            </div>
            
            <button id="startOcrBtn" class="action-button" disabled>
                <i class="fas fa-microchip"></i> Start Hindi OCR
                <i class="fas fa-spinner fa-spin"></i>
            </button>
            <div id="ocrStatus" class="status">Initializing Tesseract.js... Please wait.</div>

            <div class="ocr-output-area" id="ocrOutputWrapper" style="display:none;">
                <textarea id="ocrResultText" rows="10" readonly placeholder="Extracted Hindi text will appear here..."></textarea>
                <div class="download-buttons">
                    <button id="downloadTxtBtn" class="action-button"><i class="fas fa-file-alt"></i> Download .txt</button>
                    <button id="downloadMdBtn" class="action-button"><i class="fab fa-markdown"></i> Download .md</button>
                </div>
            </div>
        </div>
    </div>

    <canvas id="pdfPreviewCanvas"></canvas> <!-- Hidden canvas for PDF page rendering -->

    <div class="info-message">
        <i class="fas fa-info-circle"></i>
        <div>
            <strong>Client-Side Processing:</strong> OCR is performed in your browser. Performance depends on file size and your device. For best results with PDFs, ensure they contain scanned images or text that can be imaged, not just vector graphics.
        </div>
    </div>

    <footer>
        Powered by Tesseract.js. Secure Client-Side Processing.
    </footer>

    <script>
        const ocrFileInput = document.getElementById('ocrFile');
        const ocrFileNameDisplay = document.getElementById('ocrFileName');
        const ocrFileWrapper = document.getElementById('ocrFileWrapper');
        const startOcrBtn = document.getElementById('startOcrBtn');
        const ocrStatus = document.getElementById('ocrStatus');
        const ocrOutputWrapper = document.getElementById('ocrOutputWrapper');
        const ocrResultText = document.getElementById('ocrResultText');
        const downloadTxtBtn = document.getElementById('downloadTxtBtn');
        const downloadMdBtn = document.getElementById('downloadMdBtn');
        const pdfPreviewCanvas = document.getElementById('pdfPreviewCanvas');

        let tesseractWorker = null;
        let currentFile = null;

        // --- Initialize Tesseract.js ---
        async function initializeTesseract() {
            updateStatus('Initializing Tesseract.js engine...', 'processing', true);
            try {
                tesseractWorker = await Tesseract.createWorker({
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            const progress = (m.progress * 100).toFixed(0);
                            updateStatus(`Recognizing text... ${progress}%`, 'processing', true);
                        } else if (m.status && m.status !== 'loaded tesseract core') {
                             updateStatus(capitalizeFirstLetter(m.status) + '...', 'processing', true);
                        }
                    }
                });
                updateStatus('Loading Hindi language data...', 'processing', true);
                await tesseractWorker.loadLanguage('hin');
                await tesseractWorker.initialize('hin');
                updateStatus('Hindi OCR ready. Select a file.', 'success');
                startOcrBtn.disabled = false;
            } catch (error) {
                console.error("Tesseract initialization failed:", error);
                updateStatus('Error: Tesseract.js failed to initialize. Check console.', 'error');
                startOcrBtn.disabled = true;
            }
        }
        
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // --- File Input Handling ---
        ocrFileInput.addEventListener('change', (event) => {
            currentFile = event.target.files[0];
            if (currentFile) {
                ocrFileNameDisplay.textContent = currentFile.name;
                ocrFileWrapper.querySelector('.file-input-text').style.display = 'none';
                ocrFileNameDisplay.style.display = 'block';
                ocrOutputWrapper.style.display = 'none'; // Hide previous results
                ocrResultText.value = '';
            } else {
                ocrFileNameDisplay.textContent = '';
                ocrFileWrapper.querySelector('.file-input-text').style.display = 'flex';
                ocrFileNameDisplay.style.display = 'none';
            }
        });
        
        // Drag and Drop for file input
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            ocrFileWrapper.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false); // Prevent browser from opening file
        });
        ['dragenter', 'dragover'].forEach(eventName => {
            ocrFileWrapper.addEventListener(eventName, () => ocrFileWrapper.classList.add('is-dragging'), false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            ocrFileWrapper.addEventListener(eventName, () => ocrFileWrapper.classList.remove('is-dragging'), false);
        });
        ocrFileWrapper.addEventListener('drop', (e) => {
            ocrFileInput.files = e.dataTransfer.files;
            const event = new Event('change');
            ocrFileInput.dispatchEvent(event);
        }, false);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }


        // --- Start OCR Process ---
        startOcrBtn.addEventListener('click', async () => {
            if (!currentFile || !tesseractWorker) {
                updateStatus('Please select a file first or wait for OCR engine.', 'error');
                return;
            }

            startOcrBtn.disabled = true;
            ocrOutputWrapper.style.display = 'none';
            ocrResultText.value = '';
            updateStatus('Processing file...', 'processing', true);

            try {
                let fullText = '';
                if (currentFile.type === "application/pdf") {
                    fullText = await processPdf(currentFile);
                } else if (currentFile.type.startsWith("image/")) {
                    const { data: { text } } = await tesseractWorker.recognize(currentFile);
                    fullText = text;
                } else {
                    throw new Error("Unsupported file type. Please use PDF or image files.");
                }

                ocrResultText.value = fullText || "No text could be extracted.";
                ocrOutputWrapper.style.display = 'block';
                updateStatus('OCR complete!', 'success');

            } catch (error) {
                console.error("OCR Error:", error);
                updateStatus(`Error during OCR: ${error.message}`, 'error');
                ocrResultText.value = `Error: ${error.message}`;
                ocrOutputWrapper.style.display = 'block'; // Show error in textarea
            } finally {
                if(tesseractWorker) startOcrBtn.disabled = false; // Re-enable only if worker is still valid
            }
        });

        // --- PDF Processing ---
        async function processPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let combinedText = '';
            const numPages = pdf.numPages;

            updateStatus(`Loaded PDF with ${numPages} pages. Starting OCR...`, 'processing', true);

            for (let i = 1; i <= numPages; i++) {
                updateStatus(`Processing PDF page ${i} of ${numPages}...`, 'processing', true);
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 2.0 }); // Higher scale for better OCR
                
                const canvasContext = pdfPreviewCanvas.getContext('2d');
                pdfPreviewCanvas.height = viewport.height;
                pdfPreviewCanvas.width = viewport.width;

                await page.render({ canvasContext, viewport }).promise;
                
                // Convert canvas to image for Tesseract
                const imageDataUrl = pdfPreviewCanvas.toDataURL('image/png');
                const { data: { text } } = await tesseractWorker.recognize(imageDataUrl);
                combinedText += text + "\n\n"; // Add space between pages

                // Brief pause to allow UI to update, especially for many pages
                if (i % 3 === 0 && i < numPages) await new Promise(r => setTimeout(r, 50));
            }
            return combinedText.trim();
        }

        // --- Download Functionality ---
        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        downloadTxtBtn.addEventListener('click', () => {
            const baseName = currentFile ? currentFile.name.split('.').slice(0, -1).join('.') : 'hindi_ocr_result';
            downloadFile(`${baseName}.txt`, ocrResultText.value, 'text/plain;charset=utf-8');
        });

        downloadMdBtn.addEventListener('click', () => {
            const baseName = currentFile ? currentFile.name.split('.').slice(0, -1).join('.') : 'hindi_ocr_result';
            // For Markdown, we might wrap it in a code block if it's purely text,
            // or just save as is. For simplicity, saving as is.
            const mdContent = "```text\n" + ocrResultText.value + "\n```"; // Simple wrapping
            downloadFile(`${baseName}.md`, mdContent, 'text/markdown;charset=utf-8');
        });

        // --- Utility Functions ---
        function updateStatus(message, type = 'info', showSpinner = false) {
            if (!ocrStatus) return;
            let fullMessage = message;
            if (showSpinner) {
                fullMessage = `<i class="fas fa-spinner fa-spin"></i> ${message}`;
                ocrStatus.innerHTML = fullMessage;
            } else {
                ocrStatus.textContent = message;
            }
            ocrStatus.className = 'status';
            if (type === 'success') ocrStatus.classList.add('success');
            else if (type === 'error') ocrStatus.classList.add('error');
            else if (type === 'processing') ocrStatus.classList.add('processing');
        }
        
        // --- Initialize on Load ---
        document.addEventListener('DOMContentLoaded', initializeTesseract);
    </script>
</body>
</html>
